{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">📋 My Tasks</h2>
    <a href="{% url 'task_add' %}" class="btn btn-outline-success" style="color: black;">➕ Add Task</a>
  </div>

  <!-- Filter Dropdown -->
  <form method="get" class="mb-3">
    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <label for="status" class="col-form-label">Filter by status:</label>
      </div>
      <div class="col-auto">
        <select id="status" name="status" class="form-select" onchange="this.form.submit()">
          <option value="">All</option>
          <option value="Pending" {% if request.GET.status == "Pending" %}selected{% endif %}>Pending</option>
          <option value="Completed" {% if request.GET.status == "Completed" %}selected{% endif %}>Completed</option>
        </select>
      </div>
    </div>
  </form>

  <!-- Task List Table -->
  {% if tasks %}
  <table class="table table-striped table-hover shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Image</th>
        <th style="width: 180px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td><strong>{{ task.title }}</strong></td>
        <td>
          {% if task.status == "Completed" %}
          <span class="badge bg-success">Completed</span>
          {% else %}
          <span class="badge bg-warning text-dark">Pending</span>
          {% endif %}
        </td>

        <td>{{ task.due_date|date:"M d, Y" }}</td>
        <td>

          <!-- <a href="{{ task.image.url }}" target="_blank">
            <img src="{{ task.image.url }}" width="50" height="50" />
           </a> -->
          <img src="{{ task.image.url }}" width="50" height="50" data-bs-toggle="modal"
            data-bs-target="#imageModal{{ task.id }}" style="cursor: pointer;" />
          <!-- Modal -->
          <div class="modal fade" id="imageModal{{ task.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content">
                <div class="modal-body text-center">
                  <img src="{{ task.image.url }}" class="img-fluid" alt="Full Image">
                </div>
              </div>
            </div>
          </div>

        </td>
        <td>
          <a href="{% url 'task_edit' task.pk %}" class="btn btn-sm btn-outline-primary me-1" style="color: black;">✏️
            Edit</a>

          <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-outline-danger" style="color: black;">❌
            Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="alert alert-info text-center">
    No tasks yet. <a href="{% url 'task_add' %}" class="alert-link">Add your first task</a>!
  </div>
  {% endif %}
</div>
{% endblock %}